language: android
jdk: oraclejdk8
dist: precise
sudo: required
android:
  components:
    - tools
    - platform-tools
    - build-tools-25.0.2
    - build-tools-25.0.1
    - android-25
    - extra-google-google_play_services
    - extra-google-m2repository
    - extra-android-m2repository
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache
before_install:
  - sudo chmod +x gradlew
  - >-
    wget
    https://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip
  - unzip android-ndk-r16b-linux-x86_64.zip -d $HOME
  - export ANDROID_NDK_HOME=$HOME/android-ndk-r16b
  - 'export PATH=$PATH:$ANDROID_NDK_HOME'
  - mkdir "$ANDROID_HOME/licenses" || true
  - >-
    echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >
    "$ANDROID_HOME/licenses/android-sdk-license"
  - >-
    echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" >
    "$ANDROID_HOME/licenses/android-sdk-preview-license" - 'echo | sudo
    add-apt-repository ppa:deadsnakes/ppa'
  - sudo apt-get update
  - sudo apt-get upgrade
  - sudo apt-get install -y python3.6
before_script:
  - travis_wait 5 ./scripts/setup_dependencies.sh
  - ./gradlew clean
script:
  - 'curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo'
  - chmod a+x ~/bin/repo
  - cd
  - 'repo init -u https://github.com/0reo27/travisTest'
  - repo sync
  - cd Magisk
  - >-
    time python3.6 build.py all ${MAGISK_VER_STRING} ${MAGISK_VER_INTEGER} &&
    echo "Magisk has been successfully built"
  - cd
  - cd Magisk
  - cd out
  - 'cp -fpRv *.{zip,apk} "$TRAVIS_BUILD_DIR"'
  - cd "$TRAVIS_BUILD_DIR"
  - ls -l
deploy:
  provider: releases
  tag_name: $MAGISK_VER_STRING
  api_key:
    secure: >-
      VeP/gjAFFs+w/nh8TUGLaC7sLVaH0KNgdNl8Q7yWoeayOY282RHiQeGA+5z2ESGlM3ui9vYCMqSupjgu07iy5VonsABZ5X7yAjle0c0ZFbQYgqkLJvTZ3OW0jlehG3rL7g/b/rQ8ZB3SFs4ZHp2kJwIF0I7f2lpZPIVsgL7XDBfBwjCBNPfMJ3A7m2bcR7FniUBFc9uHgbkkBEV4AEzPaTlDsYKUTIIDe94TLALeDrROvyAxZO/MA3vNsZnTNcIAQrY5WJtU4G/vfSDMtv/q5M7yjASvGBw/uwTnCDZjDCAnxvdMu2J1QVne1aYWDkV0+iX4kj/v4NKU855HbRg+tLFCeEaDnThq5hSt/zSf79HT9TMFUUFdlBAbApU0u41A2mFGrh4imdk5ELlbWSQS5yj5EGFyv11uOenAxrysyEtKk3sWXI6/91Zpewr8HkrprXGv4rctiM6sKpdcKIs99nCQf/CPmL1tQlYgACW86yp7JeqAgmr6eD3gdjajynWLog/EbpjZT1XxxqpNV/kyUuy4QTgeB0x/QE9rllUaPB1viHVHSDSpwBA0fvRBQ6s8EOOwYJPjHhGwGhoB1/Degvx8KGU+icXhUgo5AASjVA3DPOwpyPphQNZ9QEGnZjmXV8uTJ1mEzBBX3s+gB6D035+sxGbFBT7iiN2q6krVi00=
  file_glob: true
  file: ./*
  overwrite: true
  on:
    repo: 0reo27/travisTest
notifications:
  email: false
